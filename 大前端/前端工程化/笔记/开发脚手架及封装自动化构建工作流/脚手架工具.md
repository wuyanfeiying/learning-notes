<!--
 * @Date: 2021-07-17 10:40:02
 * @LastEditors: chuhongguang
-->
[TOC]
### 脚手架概述
> 脚手架就是一个可以自动化创建项目的工具，创建项目基础结构、提供项目规范和结构。

搭建项目的时候会有很多的共同点，比如：
- 相同的组织结构
- 相同的开发范式
- 相同的模块依赖。
- 相同的工具配置。
- 相同的基础代码。
以上这些都是一些搭建项目共同的点，为了提高效率，我们通常会用脚手架，然后里面会提供一些相同的一些基础代码供我们使用。

### 常用的脚手架工具
- React项目中 --> create-react-app
- Vue.js 项目中 --> vue-cli
- Angular 项目中 --> angualr-cli
这些脚手架工具，无外乎都是根据信息创建对应的项目基础结构，但是大多数都是为了自身项目而维护(针对于某一个框架）。
> 当然也有一些通用型的脚手架工作：
-  Yeoman
可以根据一套模板，生成对应的项目结构，这种类型的脚手架一般都很灵活，而且很容易扩展。
- Plop
可以用来项目开发过程中，用来创建一些特定类型的组件或者创建模块所需要的文件。

### Yeoman
> 一款用于创造现代化web应用的脚手架工具
不同于cli这样的工具，Yeoman更像是一个脚手架的运行平台，可以通过Yeoman搭配不同的generator去创建任何类型的项目，也就是可以根据创建generator去定制自己的前端脚手架。
当然也有一些缺点，在很多专注于基于框架开发的人眼中，Yeoman过于通用，不够专注（不像vue-cli 只针对vue框架）。

#### Yeoman 基础使用
```js
npm install yarn -g // 全局安装 yarn
yarn global add yo // 全局安装Yeoman
yarn global add generator-node // 全局安装 generator-node， 自动的创建一个新的 node module
```
创建一个新的文件夹 `my-module`
```js
yo node // 运行generator-node，省略的写法
```
⚡win10里面如果是`npm`安装`yarn`可能运行不了 `yo node`
```js
$ yo node
bash: yo: command not found
```

需要手动配置环境变量才可：
```js
yarn global bin // 找到目录
```

<img src="..\..\img\win10中yarn配置环境变量.png" style="zoom: 50%;" />

接下来正常进行： `yo node` 后续操作,填写一些对应的信息，结果如下：
<img src="..\..\img\yo-node-test.png" style="zoom: 50%;" />

#### Sub Generator
有时候我们并不需要去创建完整的项目结构，可能我们只需要在已有的项目基础上创建一些特定类型的文件。例如：给已经存在的项目创建 readme.md;在原有的项目基础之上添加一些配置文件（ESlint...);这些配置文件都有一些基础的代码，如果自己去配置，很容易弄错。
我们可以通过生成器自动帮我们生成，这样不仅减少了错误，还可以提升效率。

需要需要满足以上这些场景的需求，那么可以使用 Yeoman 提供的 Sub Generator 来实现。
使用 generator-node 模块中的 cli，
```js
yo node:cli
```

#### Yeoman 常规使用步骤
Yeoman是通用型的脚手架工作，所以我们可以使用它创建任何类型的项目。
使用 Yeoman的步骤：
1. 明确你的需求；
2. 找到合适的Generator;
3. 全局范围安装找到的 Generator;
4. 通过Yo运行对应的Generator;
5. 通过命令行交互填写选项；
6. 生成你所需要的项目结构；

#### 自定义Generator
> 基于 Yeoman 搭建自己的脚手架

不同的Generator可以生成不同的项目, 我们可以通过创造自己的Generator来生成自己的自定义的Generator结构。

#### 创建 Generator模块
> 创建Generator其实就是创建一个 NPM 模块。
但是，Generator本身有特定的基本结构：
```
├── generators/ ................................... 生成器目录
|  ├── app/     ................................... 默认生成器目录
|     └── index.js ................................ 默认生成器实现
├── package.json .................................. 模块包配置文件
```
名称：
必须是 `generator-<name>`的形式，如果在项目中没有使用这样的名称，Yeamon在后面运行的时候将不会找你，自定义生成器的模块。

### Plop
> 一个小而美的脚手架工具

用于创建项目中特定功能的小工具，有点类似于 `Yeoman`中的`Sub Generator`,一般不会单独使用Plop,一般会集成到项目当中，用来创建同类型的项目文件。

#### 使用场景
日常项目中面临的问题：经常会重复的创建一些重复的项目文件。
例如：一个项目中，每次创建一个文件，都会包含3个文件：`css,js,test.js`, 每个文件当中还会有一些基础的代码（比如引入一些模块...)
使用 Plop后，只需要运行Plop,填写一些询问信息的配置之后，然后根据输入的结果，自动的创建配置文件，这样**保障了每次创建文件的格式都是统一的，而且都是自动化的，大大提高了在项目中创建文件每次都要写重复文件的效率**。

#### 在项目中具体使用 Plop
- 将`plop`模块作为项目开发依赖安装
- 在项目根目录下创建一个 `plopfile.js` 文件
- 在`plopfile.js` 文件中定义脚手架任务
- 编写用户生成特定类型文件的模板
- 通过 `Plop` 提供的 `CLI` 运行脚手架任务

### 脚手架的工作原理
- 脚手架工作其实就是node中的CLI应用。
- 大部分脚手架工作的工作原理，差不多都是，启动脚手架后，会自动的询问一些预设的问题，基于用于回答的结果，生成一些相应的模板结构。
#### 脚手架的工作过程
Node.js CLI 程序入口的 JS 文件中需要定义文件头：#!/usr/bin/env node
> 记得要 `yarn link` 一下脚手架名字，链接到全局中
1. 通过命令行交互询问用户问题
2. 根据用户回答的结果生成文件
  - 通过node中的path获取模板目录
  - 通过node中的process获取目标目录
3. 将模板下的文件券不转换到目标目录
  - 通过模板引擎渲染文件
  - 将结果写入目标文件目录